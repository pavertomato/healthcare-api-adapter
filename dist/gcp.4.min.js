(window["gcp_jsonp"]=window["gcp_jsonp"]||[]).push([[4],{"725e":function(e,t,n){(function(e,n){n(t)})(0,function(e){"use strict";function t(e){return t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t,n){t=t||0,n=n||e.length-t;for(var r="",s=t;s<t+n;s++)r+=String.fromCharCode(e[s]);return r}function i(e){for(var t=new Uint8Array(e.length),n=0,r=e.length;n<r;n++)t[n]=e.charCodeAt(n);return t}function o(e){for(var t=e.split("\r\n"),n=0;n<t.length;n++)if("--"===t[n].substr(0,2))return t[n]}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e+t.length>e.length)return!1;for(var r=n,s=0;s<t.length;s++)if(t[s]!==e[r++])return!1;return!0}function u(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e.length,s=n;s<r;s++)if(e[s]===t[0]&&c(e,t,s))return s;return-1}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/dicom",r="Content-Type: ".concat(n),s="\r\n--".concat(t,"\r\n").concat(r,"\r\n\r\n"),a="\r\n--".concat(t,"--"),o=i(s),c=i(a),u=o.length,d=c.length,I=0,l=e.map(function(e){var t=new Uint8Array(e),n=t.length;return I+=u+n+d,t}),h=new Uint8Array(I);h.set(o,0);var p=0;return l.forEach(function(e){e.length;h.set(o,p),h.set(e,p+u),p+=u+e.length}),h.set(c,p),{data:h.buffer,boundary:t}}function I(e){var t=new Uint8Array(e),n=i("\r\n\r\n"),r=u(t,n);if(-1===r)throw new Error("Response message has no multipart mime header");var s=a(t,0,r),c=o(s);if(!c)throw new Error("Header of response message does not specify boundary");var d,I=i(c),f=I.length,l=[],h=r+n.length;while(-1!==d){if(d=u(t,I,h),-1===d)break;var p=2,y=d-h-p,v=e.slice(h,h+y);l.push(v),h+=y+p+f}return l}function f(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function l(e){return 0===Object.keys(e).length&&e.constructor===Object}var h=function(e){return e[0]},p={DICOM:"application/dicom",DICOM_JSON:"application/dicom+json",OCTET_STREAM:"application/octet-stream"},y=function(){function e(t){n(this,e),this.baseURL=t.url,this.baseURL||console.error("DICOMweb base url provided - calls will fail"),"username"in t&&(this.username=t.username,"password"in t||console.error("no password provided to authenticate with DICOMweb service"),this.password=t.password),this.headers=t.headers||{}}return s(e,[{key:"_httpRequest",value:function(e,n,r){var s=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise(function(i,o){var c=new XMLHttpRequest;c.open(n,e,!0),"responseType"in a&&(c.responseType=a.responseType),"object"===t(r)&&Object.keys(r).forEach(function(e){c.setRequestHeader(e,r[e])});var u=s.headers;Object.keys(u).forEach(function(e){c.setRequestHeader(e,u[e])}),c.onloadstart=function(e){},c.onloadend=function(e){},c.onreadystatechange=function(e){if(4===c.readyState)if(200===c.status)i(c.response);else if(202===c.status)console.warn("some resources already existed: ",c),i(c.response);else if(204===c.status)console.warn("empty response for request: ",c),i([]);else{console.error("request failed: ",c);var t=new Error("request failed");t.request=c,t.response=c.response,t.status=c.status,console.error(t),console.error(t.response),o(t)}},"progressCallback"in a&&"function"===typeof a.progressCallback&&(c.onprogress=a.progressCallback),"data"in a?c.send(a.data):c.send()})}},{key:"_httpGet",value:function(e,t,n,r){return this._httpRequest(e,"get",t,{responseType:n,progressCallback:r})}},{key:"_httpGetApplicationJson",value:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;"object"===t(r)&&(l(r)||(n+=e._parseQueryParameters(r)));var a={Accept:p.DICOM_JSON},i="json";return this._httpGet(n,a,i,s)}},{key:"_httpGetByMimeType",value:function(n,r,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"arraybuffer",i=arguments.length>4?arguments[4]:void 0;"object"===t(s)&&(l(s)||(n+=e._parseQueryParameters(s)));var o={Accept:'multipart/related; type="'.concat(r,'"')};return this._httpGet(n,o,a,i)}},{key:"_httpPost",value:function(e,t,n,r){return this._httpRequest(e,"post",t,{data:n,progressCallback:r})}},{key:"_httpPostApplicationJson",value:function(e,t,n){var r={"Content-Type":p.DICOM_JSON};return this._httpPost(e,r,t,n)}},{key:"searchForStudies",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log("search for studies");var n=this.baseURL+"/studies";return"queryParams"in t&&(n+=e._parseQueryParameters(t.queryParams)),this._httpGetApplicationJson(n)}},{key:"retrieveStudyMetadata",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required for retrieval of study metadata");console.log("retrieve metadata of study ".concat(e.studyInstanceUID));var t=this.baseURL+"/studies/"+e.studyInstanceUID+"/metadata";return this._httpGetApplicationJson(t)}},{key:"searchForSeries",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.baseURL;return"studyInstanceUID"in t&&(console.log("search series of study ".concat(t.studyInstanceUID)),n+="/studies/"+t.studyInstanceUID),n+="/series","queryParams"in t&&(n+=e._parseQueryParameters(t.queryParams)),this._httpGetApplicationJson(n)}},{key:"retrieveSeriesMetadata",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required for retrieval of series metadata");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required for retrieval of series metadata");console.log("retrieve metadata of series ".concat(e.seriesInstanceUID));var t=this.baseURL+"/studies/"+e.studyInstanceUID+"/series/"+e.seriesInstanceUID+"/metadata";return this._httpGetApplicationJson(t)}},{key:"searchForInstances",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.baseURL;return"studyInstanceUID"in t?(n+="/studies/"+t.studyInstanceUID,"seriesInstanceUID"in t?(console.log("search for instances of series ".concat(t.seriesInstanceUID)),n+="/series/"+t.seriesInstanceUID):console.log("search for instances of study ".concat(t.studyInstanceUID))):console.log("search for instances"),n+="/instances","queryParams"in t&&(n+=e._parseQueryParameters(t.queryParams)),this._httpGetApplicationJson(n)}},{key:"buildInstanceWadoURIUrl",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required.");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required.");if(!("sopInstanceUID"in e))throw new Error("SOP Instance UID is required.");var t=e.contentType||p.DICOM,n=e.transferSyntax||"*",r=[];r.push("requestType=WADO"),r.push("studyUID=".concat(e.studyInstanceUID)),r.push("seriesUID=".concat(e.seriesInstanceUID)),r.push("objectUID=".concat(e.sopInstanceUID)),r.push("contentType=".concat(t)),r.push("transferSyntax=".concat(n));var s=r.join("&");return"".concat(this.baseURL,"?").concat(s)}},{key:"retrieveInstanceMetadata",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required for retrieval of instance metadata");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required for retrieval of instance metadata");if(!("sopInstanceUID"in e))throw new Error("SOP Instance UID is required for retrieval of instance metadata");console.log("retrieve metadata of instance ".concat(e.sopInstanceUID));var t=this.baseURL+"/studies/"+e.studyInstanceUID+"/series/"+e.seriesInstanceUID+"/instances/"+e.sopInstanceUID+"/metadata";return this._httpGetApplicationJson(t)}},{key:"retrieveInstanceFrames",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required for retrieval of instance metadata");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required for retrieval of instance metadata");if(!("sopInstanceUID"in e))throw new Error("SOP Instance UID is required for retrieval of instance metadata");if(!("frameNumbers"in e))throw new Error("frame numbers are required for retrieval of instance frames");console.log("retrieve frames ".concat(e.frameNumbers.toString()," of instance ").concat(e.sopInstanceUID));var t=this.baseURL+"/studies/"+e.studyInstanceUID+"/series/"+e.seriesInstanceUID+"/instances/"+e.sopInstanceUID+"/frames/"+e.frameNumbers.toString(),n=e.imageSubType?"image/".concat(e.imageSubType):p.OCTET_STREAM;return this._httpGetByMimeType(t,n).then(I)}},{key:"retrieveInstance",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required");if(!("sopInstanceUID"in e))throw new Error("SOP Instance UID is required");var t=this.baseURL+"/studies/"+e.studyInstanceUID+"/series/"+e.seriesInstanceUID+"/instances/"+e.sopInstanceUID;return this._httpGetByMimeType(t,p.DICOM).then(I).then(h)}},{key:"retrieveSeries",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required");var t=this.baseURL+"/studies/"+e.studyInstanceUID+"/series/"+e.seriesInstanceUID;return this._httpGetByMimeType(t,p.DICOM).then(I)}},{key:"retrieveStudy",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required");var t=this.baseURL+"/studies/"+e.studyInstanceUID;return this._httpGetByMimeType(t,p.DICOM).then(I)}},{key:"retrieveBulkData",value:function(e){if(!("BulkDataURI"in e))throw new Error("BulkDataURI is required.");return this._httpGetByMimeType(e.BulkDataURI,p.OCTET_STREAM).then(I).then(h)}},{key:"storeInstances",value:function(e){if(!("datasets"in e))throw new Error("datasets are required for storing");var t="".concat(this.baseURL,"/studies");"studyInstanceUID"in e&&(t+="/".concat(e.studyInstanceUID));var n=d(e.datasets),r=n.data,s=n.boundary,a={"Content-Type":"multipart/related; type=application/dicom; boundary=".concat(s)};return this._httpPost(t,a,r,e.progressCallback)}}],[{key:"_parseQueryParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="?";return Object.keys(e).forEach(function(n,r){0!==r&&(t+="&"),t+=n+"="+encodeURIComponent(e[n])}),t}}]),e}();function v(e,t,n){var r=e.lastIndexOf(t)+t.length;if(r<t.length)return null;if(void 0!==n){var s=e.lastIndexOf(n);return s<0?null:e.substring(r,s)}return e.substring(r)}function U(e){var t=v(e,"studies/","/series");if(!t)t=v(e,"studies/");return t||console.debug('Study Instance UID could not be dertermined from URI "'+e+'"'),t}function m(e){var t=v(e,"series/","/instances");if(!t)t=v(e,"series/");return t||console.debug('Series Instance UID could not be dertermined from URI "'+e+'"'),t}function D(e){var t=v(e,"/instances/","/frames");if(!t)t=v(e,"/instances/","/metadata");if(!t)t=v(e,"/instances/");return t||console.debug('SOP Instance UID could not be dertermined from URI"'+e+'"'),t}function b(e){var t=v(e,"/frames/");return void 0===t&&console.debug('Frames Numbers could not be dertermined from URI"'+e+'"'),t.split(",")}var g="0.3.2",w={DICOMwebClient:y},S={getStudyInstanceUIDFromUri:U,getSeriesInstanceUIDFromUri:m,getSOPInstanceUIDFromUri:D,getFrameNumbersFromUri:b};e.api=w,e.utils=S,e.version=g,Object.defineProperty(e,"__esModule",{value:!0})})}}]);
//# sourceMappingURL=gcp.4.min.js.map