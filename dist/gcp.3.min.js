(window["gcp_jsonp"]=window["gcp_jsonp"]||[]).push([[3],{"017a":function(e,t,o){e.exports=o.p+"img/Icon-Warn.f3b4b640.svg"},"0450":function(e,t,o){var i=o("b041");t=e.exports=o("2350")(!1),t.i(o("0402"),""),t.i(o("c3d9"),""),t.push([e.i,"@import url(https://fonts.googleapis.com/css?family=Roboto);",""]),t.push([e.i,"\n.gcp-arrow-cell{text-align:right\n}\n.md-table-row{cursor:pointer\n}\n.md-table{border-radius:5px;-webkit-transition-delay:0;transition-delay:0\n}\n.md-table .md-toolbar{padding-left:0;height:57px;min-height:57px\n}\n.md-table-content,.md-table-empty-state{max-height:300px!important;height:300px!important;-webkit-transition-delay:0;transition-delay:0\n}\n.md-table-toolbar{background-color:#424242;position:relative\n}\n.md-table-fixed-header{background-color:#2a2a2a;height:40px\n}\n.md-table-fixed-header .md-table-head-container{padding-top:6px\n}\n.md-toolbar .md-tabs{padding-left:0;position:relative;left:-12px;z-index:5\n}\n.gcp-black-line{position:absolute;width:100%;height:3px;bottom:0;background-color:#000\n}\n.md-tabs-indicator{bottom:-4px;background-color:#52abd3!important\n}\n.md-button.md-active .md-button-content{color:#fff;font-weight:700\n}\n.md-field.md-theme-default:before{background-color:#52abd3!important\n}\n.md-table-empty{height:0!important;-webkit-transition-delay:0;transition-delay:0\n}\n.md-table *{-webkit-transition:none!important;transition:none!important\n}\n.md-toolbar-section-search{margin-left:25px;margin-bottom:20px!important;max-width:240px\n}\n.gcp-dicom-uploader{font-family:Roboto,Helvetica,Arial,sans-serif;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-font-smoothing:antialiased;background-color:#161a1f;width:536px;padding:30px\n}\n.gcp-dicom-uploader__exit{cursor:pointer;float:right;width:14px!important;height:14px!important;background-image:url("+i(o("50ff"))+");-webkit-filter:opacity(.5);filter:opacity(.5)\n}\n.gcp-dicom-uploader__exit:hover{-webkit-filter:opacity(1);filter:opacity(1)\n}\n.gcp-dicom-uploader__uploading{margin:5px 0 20px;font-size:16px\n}\n.gcp-dicom-uploader__progress{height:40px;background-color:#07090a!important\n}\n.gcp-dicom-uploader__progress .md-progress-bar-fill{background-color:#52abd3!important\n}\n.gcp-dicom-uploader__progress_block{position:relative;cursor:pointer\n}\n.gcp-dicom-uploader__status{position:absolute;line-height:40px;top:0;width:100%;font-size:14px;white-space:nowrap\n}\n.gcp-dicom-uploader__status-left{float:left;padding-right:12px;display:-webkit-box;display:-ms-flexbox;display:flex;position:relative\n}\n.gcp-last-file{text-overflow:ellipsis;overflow:hidden;max-width:120px;min-width:120px\n}\n.gcp-dicom-uploader__status-right{float:right;padding:0 12px\n}\n.gcp-dicom-uploader__volume{padding-left:10px;opacity:.5\n}\n.gcp-dicom-uploader__bottom{height:50px\n}\n.gcp-dicom-uploader__cancel-btn{float:right;margin-top:20px;text-transform:none;font-size:13px;height:32px;width:80px;background-color:#52abd3\n}\n.gcp-status-icon{padding:2px 18px;background-position:50%;background-repeat:no-repeat;background-image:url("+i(o("1be7"))+")\n}\n.gcp-icon-turned{-webkit-transform:rotate(90deg);transform:rotate(90deg);margin-top:-2px\n}\n.gcp-error-icon{padding-top:3px;background-image:url("+i(o("017a"))+")\n}\n.gcp-dicom-uploader__error-message{position:absolute;z-index:-10;padding-left:38px;font-size:14px\n}\n.gcp-dicom-uploader__progress_block.gcp-has-error:hover{background-color:red\n}\n.gcp-dicom-uploader__progress_block.gcp-has-error:hover .gcp-dicom-uploader__volume,.gcp-dicom-uploader__progress_block.gcp-has-error:hover .gcp-last-file{z-index:-10\n}\n.gcp-dicom-uploader__progress_block.gcp-has-error:hover .gcp-dicom-uploader__error-message{z-index:1\n}",""])},"09b7":function(e,t,o){var i=o("0450");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=o("35d6").default;e.exports.__inject__=function(e){n("2e3550cb",i,e)}},"1be7":function(e,t,o){e.exports=o.p+"img/Icon-Arrow.e493b444.svg"},"1f0b":function(e,t,o){"use strict";o.r(t);var i=o("ee2e"),n=o.n(i);for(var r in i)"default"!==r&&function(e){o.d(t,e,function(){return i[e]})}(r);t["default"]=n.a},"1fed":function(e,t,o){var i=o("ad62");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=o("35d6").default;e.exports.__inject__=function(e){n("682d3c56",i,e)}},2504:function(e,t,o){e.exports=o.p+"img/Button_Folder.271da60b.svg"},"2fa3":function(e,t,o){"use strict";function i(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}function n(e){if(!e)return"Unknown error";if(e.response)try{const o=JSON.parse(e.response);if(o.error&&o.error.code&&o.error.message)return o.error.code+" - "+o.error.message}catch(t){return e.response}return e.message||"Unknown error."}function r(e){const t=sessionStorage.getItem(e);if(t)return JSON.parse(t).access_token}function s(e){if(e.length<=132)return!1;const t=new Uint8Array(e.slice(128,132));return Array.from("DICM").every((e,o)=>e.charCodeAt(0)===t[o])}o.d(t,"b",function(){return i}),o.d(t,"d",function(){return n}),o.d(t,"c",function(){return r}),o.d(t,"a",function(){return s})},"50ff":function(e,t,o){e.exports=o.p+"img/Icon-24px-Close.d1a4d6d2.svg"},"59bc":function(e,t,o){"use strict";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"gcp-dicom-uploader"},[o("div",{staticClass:"gcp-dicom-uploader__top"},[o("div",{staticClass:"gcp-dicom-uploader__uploading"},[e._v("\n      "+e._s(e.status)+"\n      "),e.percents?o("span",[e._v(e._s(e.percents)+"%")]):e._e(),o("div",{staticClass:"gcp-dicom-uploader__exit",on:{click:e.onCloseClick}})])]),null==e.files?o("FilesSelector",{attrs:{onSelect:e.onSelectFiles}}):o("div",[o("div",{class:["gcp-dicom-uploader__progress_block",{"gcp-has-error":e.errorsCount&&e.isFilesListHidden}],on:{click:function(t){e.isFilesListHidden=!e.isFilesListHidden}}},[o("md-progress-bar",{staticClass:"gcp-dicom-uploader__progress",attrs:{"md-mode":"determinate","md-value":e.percents}}),o("div",{staticClass:"gcp-dicom-uploader__status"},[o("div",{staticClass:"gcp-dicom-uploader__status-left"},[o("div",{class:["gcp-status-icon",e.statusIcon]}),o("span",{staticClass:"gcp-dicom-uploader__error-message"},[e._v(e._s(e.errorsMessage))]),o("span",{staticClass:"gcp-last-file"},[e._v(e._s(e.lastFile))]),o("span",{staticClass:"gcp-dicom-uploader__volume"},[e._v("\n            "+e._s(e.volumeLeft)+"\n          ")])]),o("div",{staticClass:"gcp-dicom-uploader__status-right"},[e._v("\n          "+e._s(e.filesLeft)+"\n        ")])])],1),o("UploaderFilesList",{attrs:{files:e.uploadedList,isHidden:e.isFilesListHidden}}),o("div",{staticClass:"gcp-dicom-uploader__bottom"},[o("md-button",{staticClass:"gcp-dicom-uploader__cancel-btn",on:{click:e.onButtonClick}},[e._v(e._s(e.buttonCaption))])],1)],1)],1)},n=[],r=(o("f2fe"),function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"gcp-files-selector"},[o("md-button",{staticClass:"gcp-files-selector__btn-dir",on:{click:function(t){e.$refs.dirSelecor.click()}}}),o("md-button",{staticClass:"gcp-files-selector__btn-file",on:{click:function(t){e.$refs.fileSelecor.click()}}}),o("input",{ref:"dirSelecor",staticClass:"gcp-invisible-input",attrs:{type:"file",accept:".dcm",webkitdirectory:"",mozdirectory:""},on:{change:function(t){e.onSelect(t.target.files)}}}),o("input",{ref:"fileSelecor",staticClass:"gcp-invisible-input",attrs:{type:"file",accept:".dcm",multiple:""},on:{change:function(t){e.onSelect(t.target.files)}}})],1)}),s=[],a={name:"FilesSelector",props:{onSelect:{type:Function,required:!0}}},l=a,c=o("2877");function d(e){var t=o("a2a1");t.__inject__&&t.__inject__(e)}var p=Object(c["a"])(l,r,s,!1,d,null,null,!0);p.options.__file="FilesSelector.vue";var u=p.exports,f=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("md-content",{class:["gcp-uploader-files-list","md-scrollbar",{"gcp-hidden":e.isHidden}]},e._l(e.files,function(t){return o("div",{key:t.id,class:["gcp-uploader-files__item",{"gcp-uploader-files__error":t.error}]},[o("div",{staticClass:"gcp-uploader-files__item-text"},[e._v(e._s(t.path))]),t.error?o("div",{staticClass:"gcp-uploader-files__error-msg"},[e._v("\n      "+e._s(t.error)+"\n    ")]):e._e()])}))},g=[],m={name:"UploaderFilesList",props:{files:Array,isHidden:Boolean}},h=m;function _(e){var t=o("1f0b");t.__inject__&&t.__inject__(e)}var b=Object(c["a"])(h,f,g,!1,_,null,null,!0);b.options.__file="UploaderFilesList.vue";var x=b.exports,v=o("2fa3");const w=o("725e");class k{setOidcStorageKey(e){e||console.error("OIDC storage key is empty"),this.oidcStorageKey=e}async smartUpload(e,t,o,i,n){const r=1,s=50;let a=Array.from(e);if(0===a.length)return void console.warn("No files are supplied for uploading");let l=Math.min(a.length,s),c=!1;const d=async(e,s)=>{while(a.length>0){if(n.get())return;let s=a.slice(0,r);a=a.slice(r);let d=null;try{if(s.length>1)throw new Error("Not implemented");1===s.length&&await this.simpleUpload(s[0],t,o)}catch(l){d=Object(v["d"])(l)}if(s.forEach(e=>i(e.fileId,d)),!c&&0===a.length)return c=!0,void e()}};await new Promise(e=>{for(let t=0;t<l;t++)d(e)})}async simpleUpload(e,t,o){const i=this.getClient(t),n=await this.readFile(e),r=n.content;if(!Object(v["a"])(r))throw new Error("The file has a wrong DICOM header");await i.storeInstances({datasets:[r]})}readFile(e){const t=new Promise((t,o)=>{var i=new FileReader;i.onload=(()=>{t({name:e.name,size:e.size,type:e.type,content:i.result})}),i.onerror=(e=>o(e)),i.readAsArrayBuffer(e)});return t}getClient(e){if(!this.oidcStorageKey)throw new Error("OIDC storage key is not set");const t=Object(v["c"])(this.oidcStorageKey);if(!t)throw new Error("OIDC access_token is not set");return new w.api.DICOMwebClient({url:e,headers:{Authorization:"Bearer "+t}})}}var y=new k;class C{constructor(){this.cancelled=!1}get(){return this.cancelled}set(e){this.cancelled=e}}var S={name:"DicomUploader",components:{FilesSelector:u,UploaderFilesList:x},props:{id:{type:String,required:!0},event:{type:String,required:!0},url:{type:String,required:!0},oidcKey:{type:String,required:!0}},data:()=>({status:"Upload",isCancelled:!1,errorsCount:0,files:null,uploadedVolume:null,wholeVolumeStr:null,isFilesListHidden:!0,timeLeft:null,uploadedList:null,totalCount:0,successfullyUploadedCount:0,lastFile:"",uploadContext:null}),computed:{filesLeft(){return this.totalCount?this.successfullyUploadedCount+" of "+this.totalCount:""},volumeLeft(){if(!this.wholeVolumeStr)return"";let e=Object(v["b"])(this.uploadedVolume);return e.indexOf(" ")>=0&&e.split(" ")[1]===this.wholeVolumeStr.split(" ")[1]&&(e=e.split(" ")[0]),e+" of "+this.wholeVolumeStr},percents(){return this.files&&this.uploadedList?parseInt(100*this.uploadedList.length/Object.keys(this.files).length):0},isFinished(){return this.isCancelled||Object.keys(this.files).length===this.uploadedList.length},buttonCaption(){return this.isFinished?"Close":"Cancel"},errorsMessage(){if(!this.errorsCount)return"";const e=1===this.errorsCount?" error":" errors";return this.errorsCount+e+" while uploading, click for more info"},statusIcon(){if(this.errorsCount)return"gcp-error-icon";let e="gcp-status-icon";return this.isFilesListHidden||(e+=" gcp-icon-turned"),e}},created:function(){y.setOidcStorageKey(this.oidcKey)},methods:{onSelectFiles:function(e){const t=Array.from(e),o={};t.forEach((e,t)=>{const i={id:t,name:e.name,path:e.webkitRelativePath||e.name,size:e.size,error:null,processed:!1,processedInUI:!1};o[t]=i,e.fileId=t}),this.status="Uploading...",this.files=o,this.uploadedList=[],this.uploadedVolume=0,this.lastFile=t[0].name,this.totalCount=t.length;const i=t.map(e=>e.size).reduce((e,t)=>e+t);this.wholeVolumeStr=Object(v["b"])(i);const n=Math.random();this.uploadContext=n,this.cancellationToken=new C;const r=(e,t)=>n===this.uploadContext&&this.uploadCallback.call(this,e,t);y.smartUpload(e,this.url,this.token,r,this.cancellationToken)},uploadCallback:function(e,t){const o=this.files[e];o.processed=!0,t?(o.error=t,this.errorsCount+=1):this.uploadedVolume+=o.size,this.lastFile=o.name,this.uploadedList.push(o)},onCloseClick(){this.cancellationToken&&this.cancellationToken.set(!0),this.onClose()},onButtonClick(){this.isFinished?this.onClose():this.cancellationToken.set(!0)},onClose(){window.$("#"+this.$props.id).trigger(this.$props.event)}}},F=S;function j(e){var t=o("9455");t.__inject__&&t.__inject__(e)}var L=Object(c["a"])(F,i,n,!1,j,null,null,!0);L.options.__file="DicomUploader.vue";t["default"]=L.exports},9455:function(e,t,o){"use strict";o.r(t);var i=o("09b7"),n=o.n(i);for(var r in i)"default"!==r&&function(e){o.d(t,e,function(){return i[e]})}(r);t["default"]=n.a},a2a1:function(e,t,o){"use strict";o.r(t);var i=o("1fed"),n=o.n(i);for(var r in i)"default"!==r&&function(e){o.d(t,e,function(){return i[e]})}(r);t["default"]=n.a},ad62:function(e,t,o){var i=o("b041");t=e.exports=o("2350")(!1),t.push([e.i,"\n.gcp-files-selector{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between\n}\n.gcp-files-selector__btn-dir,.gcp-files-selector__btn-file{height:80px!important;width:228px!important;font-size:14px;border-radius:8px;margin:0!important\n}\n.gcp-files-selector__btn-dir{background-image:url("+i(o("2504"))+")\n}\n.gcp-files-selector__btn-file{background-image:url("+i(o("e685"))+")\n}\n.gcp-invisible-input{position:absolute;display:none;z-index:-1000;max-width:0!important;max-height:0!important\n}\n.gcp-hidden{display:none\n}",""])},d067:function(e,t,o){t=e.exports=o("2350")(!1),t.push([e.i,"\n.gcp-uploader-files-list{overflow:auto;background-color:#07090a!important;height:370px;padding:10px 0;border-top:1px solid grey\n}\n.gcp-uploader-files__item{font-size:13px;margin:3px 0;line-height:15px\n}\n.gcp-uploader-files__item-text{white-space:nowrap;display:inline-block;padding:0 10px;min-width:100%\n}\n.gcp-uploader-files__error .gcp-uploader-files__item-text{background-color:#ec4444\n}\n.gcp-uploader-files__error-msg{background-color:#07090a;color:#ec4444;font-weight:700;display:inline-block;padding:0 10px 0 30px\n}",""])},e685:function(e,t,o){e.exports=o.p+"img/Button_File.473e74a7.svg"},ee2e:function(e,t,o){var i=o("d067");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=o("35d6").default;e.exports.__inject__=function(e){n("2280bbaa",i,e)}},f2fe:function(e,t,o){"use strict";var i=o("8bbf"),n=o.n(i),r=o("7193"),s=o.n(r),a=o("75ac"),l=o.n(a),c=o("ff80"),d=o.n(c),p=o("765c"),u=o.n(p),f=o("935b"),g=o.n(f),m=o("be9a"),h=o.n(m),_=o("53fc"),b=o.n(_),x=o("ac58"),v=o.n(x);n.a.use(s.a),n.a.use(d.a),n.a.use(l.a),n.a.use(u.a),n.a.use(h.a),n.a.use(g.a),n.a.use(b.a),n.a.use(v.a)}}]);
//# sourceMappingURL=gcp.3.min.js.map